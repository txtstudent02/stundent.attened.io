<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>學生請假登記系統</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f9f9f9; }
        h1 { text-align: center; }
        #login-area, #main-system { display: none; }
        #main-system { margin-top: 20px; }
        input, button { padding: 10px; margin: 5px; width: 100%; max-width: 300px; }
        .student-btn { margin: 5px; padding: 10px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>學生請假登記系統</h1>
    
    <div id="login-area">
        <h2>請先登入</h2>
        <input type="text" id="account" placeholder="帳號">
        <input type="password" id="password" placeholder="密碼">
        <button id="login-button">登入</button>
    </div>
    
    <div id="main-system">
        <button id="logout-button">登出</button>
        <h2>請假登記</h2>
        <div id="student-list"></div>
        <input type="date" id="leave-date">
        <select id="leave-type">
            <option value="病假">病假</option>
            <option value="事假">事假</option>
        </select>
        <button id="register-leave">登記請假</button>
        <div id="records"></div>
    </div>

    <script>
        const loginArea = document.getElementById('login-area');
        const mainSystem = document.getElementById('main-system');
        const studentsDiv = document.getElementById('student-list');
        const recordsDiv = document.getElementById('records');
        const loginButton = document.getElementById('login-button');
        const logoutButton = document.getElementById('logout-button');
        const registerLeaveButton = document.getElementById('register-leave');
        let students = [];
        let records = [];

        async function fetchStudents() {
            const response = await fetch('/api/students');
            students = await response.json();
            renderStudentButtons();
        }

        function renderStudentButtons() {
            studentsDiv.innerHTML = '';
            students.forEach((student, index) => {
                const button = document.createElement('button');
                button.textContent = student.name;
                button.className = 'student-btn';
                button.onclick = () => selectStudent(index);
                studentsDiv.appendChild(button);
            });
        }

        function selectStudent(index) {
            // Logic to select a student for leave registration
            console.log(`Selected ${students[index].name}`);
        }

        async function login() {
            const account = document.getElementById('account').value;
            const password = document.getElementById('password').value;
            const response = await fetch('/api/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ account, password })
            });
            if (response.ok) {
                loginArea.style.display = 'none';
                mainSystem.style.display = 'block';
                await fetchStudents();
            } else {
                alert('登入失敗');
            }
        }

        loginButton.addEventListener('click', login);
        logoutButton.addEventListener('click', () => {
            mainSystem.style.display = 'none';
            loginArea.style.display = 'block';
        });

        registerLeaveButton.addEventListener('click', async () => {
            const date = document.getElementById('leave-date').value;
            const type = document.getElementById('leave-type').value;
            // Assume selectedStudent holds the index of the selected student
            const selectedStudent = students.find(student => student.selected);
            if (selectedStudent) {
                await fetch('/api/registerLeave', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ studentId: selectedStudent.id, date, type })
                });
                recordsDiv.innerHTML += `<p>${selectedStudent.name} 請假 ${date}(${type})</p>`;
            } else {
                alert('請選擇學生');
            }
        });

        // Initialize login area
        loginArea.style.display = 'block';
    </script>
</body>
</html>
